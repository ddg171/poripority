<template>
  <NuxtPicture

    :provider="provider"
    :src="props.src"
    class="picture-box"
    legacy-format="jpeg"
    :img-attrs="imgAttr"
    :modifiers="modifiers"
    :loaded="isLoaded"
    @load="isLoaded = true"
  />
</template>

<script setup lang="ts">

const isLoaded = ref(false)

interface Props {
    src:string, alt?:string, title?:string, fromCms?:boolean}

const imgAttr = computed(() => {
  return {
    class: 'img-inside-picture',
    height: 400,
    width: 400,
    decoding: 'async',
    alt: props.alt || '',
    title: props.title || ''
  }
})

const props = withDefaults(defineProps<Props>(), { source: () => [], src: '', alt: '', title: '', fromCMS: false })

const provider = computed(() => {
  return props.fromCms ? 'imgix' : 'ipx'
})

const modifiers = computed(() => {
  return props.fromCMS
    ? {
        fm: 'webp',
        decoding: 'async'

      }
    : {}
})
// loadイベントが発火しないことがあるため、強制的にロード完了にする
onMounted(() => {
  setTimeout(() => {
    isLoaded.value = true
  }, 3000)
})
</script>
<style scoped lang="scss">
.picture-box{
  opacity: 0;
}

.picture-box[loaded="true"]{
  opacity: 1;
  transition: opacity 0.5s ease-in-out;
}
</style>
